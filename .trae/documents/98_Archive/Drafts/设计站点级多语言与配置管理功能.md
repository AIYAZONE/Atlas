# 重构多语言系统：定义与编辑管理方案

> 已合并至主干规范文档：[i18n-management-spec.md](../../02_Technical_Architecture/i18n-management-spec.md)。本文件仅作历史参考，不再维护。

## 1. 现状与目标
- **现状**：公司已有 `jds-i18n` npm 包（纯代码/硬编码），但缺乏“定义（可视化管理）”与“编辑（动态配置）”能力。
- **目标**：结合 Atlas 的可视化建站需求，设计一套**动态的多语言管理系统**，既能兼容 `jds-i18n` 的运行时能力，又能提供类似 CMS 的翻译键管理界面。

## 2. 核心设计：动态翻译管理 (Translation Management)

### 2.1 翻译键定义 (Translation Schema)
为了实现“定义与编辑管理”，我们需要将翻译键（Key）本身也视为一种 Schema。
不仅仅是 key-value，我们需要定义每个 key 的**上下文、类型和约束**，以便在编辑器中生成友好的 UI。

**新增 `TranslationSchema` 定义：**
```typescript
interface TranslationDefinition {
  id: string;          // 键路径 (如 "general.search.placeholder")
  label: string;       // 编辑器显示的字段名 (如 "搜索框占位符")
  type: 'text' | 'richtext' | 'plural'; // 翻译类型
  description?: string; // 语境说明 (给翻译人员看)
  default: string | { one: string; other: string }; // 默认文案
  variables?: string[]; // 支持的变量 (如 ["count", "name"])
}

interface TranslationGroup {
  id: string;          // 组 ID (如 "general", "cart")
  name: string;        // 组显示名
  items: (TranslationDefinition | TranslationGroup)[];
}
```

### 2.2 站点语言配置 (Site Locale Config)
在 `packages/schema/src/shopify-compatible.ts` 中补充站点级的语言配置结构。

```typescript
export interface SiteLocaleConfig {
  default_locale: string;       // 默认语言 (e.g. "en")
  published_locales: string[];  // 已发布语言列表
  
  // 翻译数据 (存储层)
  // 结构：{ "en": { "general.search.submit": "Search" }, "zh-CN": { ... } }
  translations: Record<string, Record<string, string>>; 
}
```

### 2.3 集成策略 (Adapter Pattern)
为了兼容 `jds-i18n`，我们将 Atlas 管理的 JSON 数据视为**数据源**。
- **构建时/运行时**：Atlas 将数据库中的 `translations` 导出为 `jds-i18n` 可消费的 JSON/JS 对象。
- **编辑器中**：Atlas 提供可视化界面，让运营人员修改这些 Key 的值。

## 3. 功能模块规划

### 3.1 翻译编辑器 (Translation Editor)
这是一个新的编辑器面板，用于管理全局文案。
- **左侧**：翻译组导航 (General, Cart, Checkout...)。
- **中间**：Key 列表，显示 Label 和 Description。
- **右侧**：多语言输入框 (English, Chinese...)，支持变量高亮。

### 3.2 Schema 中的引用
继续支持 `t:` 语法，但现在的 `t:` 引用是指向我们动态管理的 `TranslationDefinition`。

## 4. 执行计划

1.  **Update**: 修改 `packages/schema/src/shopify-compatible.ts`：
    -   添加 `TranslationDefinition` 和 `TranslationGroup` 接口（用于定义）。
    -   添加 `SiteLocaleConfig` 接口（用于存储）。
2.  **Write**: 创建 `docs/i18n-management-spec.md`：
    -   详细描述“翻译键定义”的 JSON 结构。
    -   展示如何将 Atlas 的动态翻译数据注入到 `jds-i18n` 中。
    -   提供一个 `TranslationSchema` 的示例（如定义购物车模块的翻译键）。

## 5. 预期价值
-   **运营自主**：运营可直接修改文案（如大促时的按钮文案），无需发版。
-   **开发规范**：开发只需定义 Key 和默认值，无需硬编码多语言文案。
-   **平滑过渡**：底层依旧可以使用 `jds-i18n` 进行渲染，Atlas 仅作为配置中心。
