# Atlas 测试策略与质量保障

> 本文档定义了 Atlas 项目的质量保障体系，涵盖从开发阶段到发布后的全链路测试。

## 1. 测试金字塔模型

我们采用分层测试策略，确保在不同粒度上验证系统正确性。

### 1.1 单元测试 (Unit Tests)
- **目标**：验证最小可测试单元（函数、工具类、无状态组件）。
- **技术栈**：
    - Java: JUnit 5 + Mockito
    - Node/Vue: Vitest
- **要求**：
    - 核心逻辑（如 Schema 校验器、数据转换函数）覆盖率需达到 90%+。
    - 必须在 CI 阶段强制执行。

### 1.2 集成测试 (Integration Tests)
- **目标**：验证多个模块或服务之间的协作（API 接口、数据库操作）。
- **技术栈**：
    - Java: Spring Boot Test + Testcontainers (PostgreSQL)
    - Node: Supertest
- **要求**：
    - 验证关键业务流程（如：保存页面 -> 触发构建 -> 模拟 S3 写入）。

### 1.3 端到端测试 (E2E Tests)
- **目标**：模拟用户真实操作，验证完整业务流。
- **技术栈**：Playwright
- **重点场景**：
    - **Builder**: 拖拽组件、修改配置、保存并预览。
    - **Runtime**: 访问发布后的静态页、点击购物车、跳转结算。

---

## 2. 专项测试

### 2.1 视觉回归测试 (Visual Regression)
- **目标**：确保 UI 组件在升级或修改后，视觉效果保持一致。
- **技术栈**：Playwright Screenshots / Storybook Test Runner.
- **场景**：核心主题组件（Header, Footer, ProductCard）。

### 2.2 Schema 兼容性测试
- **目标**：验证旧版本的 Page JSON 在新版本的 Schema 下仍能正确渲染或自动迁移。
- **场景**：每次修改 `packages/schema` 时，运行针对历史快照数据的渲染测试。

### 2.3 性能基准测试 (Performance Benchmarking)
- **目标**：确保 SSG 构建速度和 Runtime 性能不退化。
- **指标**：
    - **Build Time**: 1000 页构建耗时。
    - **Lighthouse**: Mobile 评分需保持在 95+。

---

## 3. 质量流程 (QA Process)

### 3.1 准入标准 (Pre-merge)
- 静态代码扫描 (ESLint, Checkstyle) 通过。
- 单元测试与集成测试 100% 通过。
- PR 需至少一名核心成员 Review 批准。

### 3.2 灰度与预览
- **Preview URL**: 每个 PR 自动生成独立的预览环境，供产品与设计验收。
- **Staging 环境**: 在发布到生产环境前，先发布到 Staging 站点进行最后校验。

### 3.3 监控与线上校验
- **健康检查**: `/health` 接口监控。
- **发布审计**: 自动对比发布前后的关键指标（如页面大小、JS 包体积）。
