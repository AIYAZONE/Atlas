# Atlas 项目架构演进策略与成本曲线分析报告

本报告基于 Atlas 项目 `feature/arch-serveless` 分支的架构决策，深入分析了 Serverless 与传统架构在不同业务阶段的成本表现，并总结了项目的演进策略。

## 1. 成本曲线分析：Serverless vs 传统架构

通过对流量增长与成本关系的建模分析，我们得出以下核心结论：

### 1.1 MVP 阶段 (0 - 100k PV/day)：Serverless 的绝对优势
*   **低起步成本**：Serverless 方案（Supabase/Vercel）在低流量下几乎只有基础订阅费用（约 $20/月），而传统架构（Java/AWS）由于需要维持 ALB、NAT Gateway 和 RDS 实例的运行，最低月消费在 $150 以上。
*   **边际成本递增**：Serverless 成本随请求量线性增长，但在 MVP 阶段，这种增长远低于传统架构的固定支出。

### 1.2 成本临界点 (约 120k PV/day)
*   **交叉点出现**：当流量达到约 120k PV/day 时，Serverless 的按量计费总额将超过传统架构的固定资源成本。
*   **决策信号**：此临界点是启动“逃生舱”计划、向传统架构迁移的重要财务信号。

### 1.3 Scale 阶段 (100k+ PV/day)：传统架构的边际优势
*   **规模效应**：传统架构在处理大规模并发时，通过预留实例和资源优化，其边际成本增长远低于 Serverless。
*   **架构重构价值**：在此时进行 Java 重构，虽然有一次性的人力投入，但长期运维成本将显著下降。

---

## 2. Atlas 架构演进策略总结

Atlas 采取了**“先快后稳、动态演进”**的策略，分为三个核心阶段：

### 阶段 1：MVP 极速交付 (Phase 1-2)
*   **核心架构**：Nuxt 3 + Supabase + Vercel。
*   **策略目标**：以最快速度验证业务模型，实现 8 周交付闭环。
*   **关键行动**：利用 Serverless 的 NoOps 特性，将 90% 的精力聚焦于可视化编辑器和 Shopify 兼容性 Schema 的实现。

### 阶段 2：稳定运行与监控 (Phase 2.5)
*   **核心架构**：保持 Serverless，引入更细粒度的监控。
*   **策略目标**：在流量增长过程中，通过监控 RLS 性能和 Edge Functions 延迟，确保系统稳定性。
*   **关键行动**：优化 SQL 查询，确保数据模型保持标准 PostgreSQL 规范，为迁移做准备。

### 阶段 3：企业级重构与迁移 (Phase 3+)
*   **核心架构**：Java Spring Boot + AWS RDS (PostgreSQL)。
*   **策略目标**：优化长期成本，支持复杂的企业级集成（如 SAP/Salesforce）。
*   **触发条件**：流量超过临界点，或业务逻辑复杂度超出 Node.js 生态的最优处理范围。
*   **迁移路径**：利用“逃生舱”计划，保持前端渲染库不变，仅替换后端 API 层，实现平滑过渡。

---

## 3. 结论与建议

Atlas 的架构决策并非简单的技术选型，而是一次**财务与效率的精准博弈**。
*   **建议**：在当前 MVP 阶段，应坚定执行 Serverless 路线，不应过早进行 Java 重构，以免丧失交付速度优势。
*   **预警**：需建立自动化的成本监控告警，当月度 Serverless 账单接近传统架构预估成本时，立即启动 Phase 3 的技术评审。
