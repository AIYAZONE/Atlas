# Atlas 项目下一阶段架构优化建议 (基于成本曲线分析)

本报告基于 Atlas 项目的架构演进策略与成本曲线分析，为下一阶段的架构优化提出了三个核心建议，旨在确保项目在 MVP 阶段保持高效率，并为未来的规模化增长做好充分准备。

## 核心建议一：建立成本临界点自动化监控与预警机制

**目标**：将架构决策从被动响应转变为主动管理，确保在成本最优区间内运行。

**具体行动**：
1. **定义关键指标**：将成本临界点（约 **120k PV/day**）转化为可监控的财务指标，例如“月度 Supabase/Vercel 账单总额”或“日均 API 调用次数”。
2. **设置告警阈值**：在实际成本达到临界点预估值的 **80%** 时（例如，Serverless 账单达到 $100/月），触发高优先级告警。
3. **启动技术评审**：告警触发后，立即启动 Phase 3 的技术评审会议，评估当前业务复杂度、流量增长速度，并正式启动 Java 重构的资源预估和排期。

**优势**：避免 Serverless 成本在 Scale 阶段失控，实现成本曲线的平滑过渡。

## 核心建议二：深化 Supabase RLS 策略，确保多租户隔离的零信任架构

**目标**：利用 Serverless 架构的优势，将安全治理的成本降到最低，并为未来迁移提供干净的数据基础。

**具体行动**：
1. **强制 RLS 策略**：确保所有对敏感数据（如 `pages` 表、`site_locale_config` 表）的读写操作，都通过 **PostgreSQL RLS** 进行强制校验，而非依赖应用层逻辑。
2. **最小权限原则**：严格限制 Nuxt 3 Server Routes 中使用的 Supabase Service Role 权限，仅授予必要的 CRUD 权限，杜绝超级用户权限滥用。
3. **数据模型标准化**：持续确保数据模型严格遵循 **PostgreSQL 标准**，避免过度依赖 Supabase 的专有功能（如复杂的 Edge Functions），以确保“逃生舱”计划的可行性。

**优势**：降低安全漏洞风险，简化应用层鉴权逻辑，为未来迁移提供干净、标准化的数据。

## 核心建议三：优化前端渲染库，确保后端 API 层的完全可替换性

**目标**：最大化“逃生舱”计划的价值，确保未来向 Java 架构迁移时，前端无需重写。

**具体行动**：
1. **抽象 API 接口层**：在 Nuxt 3 应用中，严格定义一个 **API 抽象层**（例如 `services/api.ts`），所有业务逻辑组件仅通过此抽象层调用后端服务。
2. **解耦数据源**：确保前端渲染库仅依赖于 **Shopify Compatible Schema** 的 JSON 数据结构，而不直接依赖 Supabase 的任何客户端 SDK 或查询语法。
3. **双重实现验证**：在 Phase 2.5 阶段，可以考虑为部分核心 API 编写一个 **Java Mock 实现**，验证前端渲染库在切换到 Java 后端时的兼容性。

**优势**：将后端重构的风险降至最低，实现前端的“一次编写，永久使用”，确保架构演进的平滑性。
